<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - Student Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f2f4f8;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container {
      max-width: 900px;
      margin: auto;
      padding: 20px;
    }
    .card {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: none;
    }
    .modal-content {
      border-radius: 12px;
    }
    .form-control {
      border-radius: 10px;
    }
    .btn {
      border-radius: 10px;
    }
    #dashboard {
      display: none;
    }
    .table-responsive {
      max-height: 400px;
      overflow-y: auto;
    }
    .report-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      padding: 20px;
      margin-top: 30px;
    }
  </style>
</head>
<body><!-- Login Modal --><div class="modal show" tabindex="-1" id="loginModal" style="display: block; background: rgba(0,0,0,0.5);">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Admin Login</h5>
      </div>
      <div class="modal-body">
        <input type="text" id="username" class="form-control mb-3" placeholder="Username">
        <input type="password" id="password" class="form-control" placeholder="Password">
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary w-100" onclick="login()">Login</button>
      </div>
    </div>
  </div>
</div><!-- Admin Dashboard --><div class="container" id="dashboard">
  <h3 class="mb-4 text-center">Admin Dashboard - Student Results</h3>  <div class="card mb-4 p-4">
    <h5>Add Student</h5>
    <div class="row g-2">
      <div class="col-md-6"><input class="form-control" id="name" placeholder="Full Name"></div>
      <div class="col-md-6"><input class="form-control" id="sex" placeholder="Sex (M/F)"></div>
    </div>
    <div class="row g-2 mt-3">
      <div class="col-md-4"><input class="form-control" id="hisabati" placeholder="Hisabati"></div>
      <div class="col-md-4"><input class="form-control" id="kiswahili" placeholder="Kiswahili"></div>
      <div class="col-md-4"><input class="form-control" id="sayansi" placeholder="Sayansi"></div>
    </div>
    <div class="row g-2 mt-3">
      <div class="col-md-4"><input class="form-control" id="english" placeholder="English"></div>
      <div class="col-md-4"><input class="form-control" id="historia" placeholder="Historia"></div>
      <div class="col-md-4"><input class="form-control" id="jiografia" placeholder="Jiografia"></div>
    </div>
    <div class="row g-2 mt-3">
      <div class="col-md-4"><input class="form-control" id="sanaa" placeholder="Sanaa"></div>
      <div class="col-md-8"><button class="btn btn-success w-100" onclick="submitStudent()">Submit Student</button></div>
    </div>
  </div>  <input class="form-control mb-3" id="search" placeholder="Search Student by Name..." onkeyup="filterTable()">  <div class="table-responsive">
    <table class="table table-bordered table-hover text-center">
      <thead class="table-dark">
        <tr>
          <th>Name</th><th>Sex</th><th>Total</th><th>Average</th><th>Rank</th><th>Action</th>
        </tr>
      </thead>
      <tbody id="studentTable"></tbody>
    </table>
  </div>  <div id="reportContainer"></div>
</div><script>
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbzqdn9Fov6k8HRZUCQxEQEfwQLSrc3Nv5l_rHLq8fx_YgsuFkvMCOi10XlHJyTvorjKYg/exec';

  async function login() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    const res = await fetch(GAS_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'login', username, password })
    });

    const result = await res.json();
    if (result.success) {
      document.getElementById("loginModal").style.display = "none";
      document.getElementById("dashboard").style.display = "block";
      loadStudents();
    } else {
      alert("Invalid credentials");
    }
  }

  async function submitStudent() {
    const data = {
      action: 'addStudent',
      name: document.getElementById("name").value,
      sex: document.getElementById("sex").value,
      hisabati: document.getElementById("hisabati").value,
      kiswahili: document.getElementById("kiswahili").value,
      sayansi: document.getElementById("sayansi").value,
      english: document.getElementById("english").value,
      historia: document.getElementById("historia").value,
      jiografia: document.getElementById("jiografia").value,
      sanaa: document.getElementById("sanaa").value
    };

    await fetch(GAS_URL, {
      method: 'POST',
      body: JSON.stringify(data)
    });
    loadStudents();
  }

  async function loadStudents() {
    const res = await fetch(GAS_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'getStudents' })
    });
    const data = await res.json();

    let html = "";
    data.forEach((s, i) => {
      html += `<tr>
        <td>${s.name}</td>
        <td>${s.sex}</td>
        <td>${s.total}</td>
        <td>${s.average}</td>
        <td>${s.rank}</td>
        <td><button class='btn btn-sm btn-primary' onclick='showReport(${i})'>Report</button></td>
      </tr>`;
    });
    document.getElementById("studentTable").innerHTML = html;
  }

  async function showReport(index) {
    const res = await fetch(GAS_URL, {
      method: 'POST',
      body: JSON.stringify({ action: 'getStudent', index })
    });
    const s = await res.json();

    const report = `
      <div class='report-card'>
        <h5><strong>School: ElimuFix Academy</strong></h5>
        <p><strong>Region:</strong> XYZ | <strong>District:</strong> ABC</p>
        <p><strong>Student Name:</strong> ${s.name}</p>
        <table class='table table-bordered'>
          <tr><td>Hisabati</td><td>${s.hisabati}</td></tr>
          <tr><td>Kiswahili</td><td>${s.kiswahili}</td></tr>
          <tr><td>Sayansi</td><td>${s.sayansi}</td></tr>
          <tr><td>English</td><td>${s.english}</td></tr>
          <tr><td>Historia</td><td>${s.historia}</td></tr>
          <tr><td>Jiografia</td><td>${s.jiografia}</td></tr>
          <tr><td>Sanaa</td><td>${s.sanaa}</td></tr>
          <tr><td><strong>Total</strong></td><td>${s.total}</td></tr>
          <tr><td><strong>Rank</strong></td><td>${s.rank}</td></tr>
        </table>
        <p><strong>Remarks:</strong> ${s.average >= 75 ? 'Excellent' : s.average >= 50 ? 'Good' : 'Fail'}</p>
        <p>Holiday begins on: ... | School reopens: ...</p>
        <p><strong>Official Stamp:</strong> _____________________</p>
      </div>`;

    document.getElementById("reportContainer").innerHTML = report;
  }

  function filterTable() {
    const term = document.getElementById("search").value.toLowerCase();
    const rows = document.querySelectorAll("#studentTable tr");
    rows.forEach(row => {
      const name = row.cells[0].innerText.toLowerCase();
      row.style.display = name.includes(term) ? "" : "none";
    });
  }
</script></body>
</html>