
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/vanilla-datatables@1.6.16/dist/vanilla-dataTables.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>






<style>


:root {
  --primary-color: #4e73df;
  --secondary-color: #f8f9fc;
  --accent-color: #2e59d9;
  --text-color: #5a5c69;
  --light-color: #ffffff;
  --dark-color: #343a40;
}

body {
  font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  color: var(--text-color);
  background-color: var(--secondary-color);
}

.wrapper {
  display: flex;
  width: 100%;
  align-items: stretch;
}

 

#content {
  width: 100%;
  padding: 15px;
  min-height: 100vh;
  transition: all 0.3s;
}

.navbar {
  padding: 15px 10px;
  background: #fff;
  border: none;
  border-radius: 0;
  margin-bottom: 40px;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
}

.navbar-btn {
  box-shadow: none;
  outline: none !important;
  border: none;
}

.card {
  border: none;
  border-radius: 0.35rem;
  box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
}

.card-header {
  background-color: #f8f9fc;
  border-bottom: 1px solid #e3e6f0;
}

.table-responsive {
  overflow-x: auto;
}

.table {
  width: 100%;
  margin-bottom: 1rem;
  color: #212529;
}

.table th, .table td {
  padding: 0.75rem;
  vertical-align: top;
  border-top: 1px solid #e3e6f0;
}

.table thead th {
  vertical-align: bottom;
  border-bottom: 2px solid #e3e6f0;
  background-color: #00008b;
  color: #ffffff;
}

.status-badge {
  padding: 0.35em 0.65em;
  font-size: 0.75em;
  font-weight: 700;
  line-height: 1;
  text-align: center;
  white-space: nowrap;
  vertical-align: baseline;
  border-radius: 0.25rem;
}

.badge-pending {
  background-color: #f6c23e;
  color: #fff;
}

.badge-active {
  background-color: #1cc88a;
  color: #fff;
}

.badge-expired {
  background-color: #e74a3b;
  color: #fff;
}

.badge-declined {
  background-color: #858796;
  color: #fff;
}

@media (max-width: 768px) {
 
  #content {
    width: 100%;
  }
  #content.active {
    width: calc(100% - 250px);
  }
}

  
</style>








  
</head>
<body>



  <!-- Page Content -->
<div id="content">
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 max-w-5xl mx-auto p-4">
      
      <!-- Active Users -->
      <div class="flex items-center gap-4 p-5 bg-white rounded-2xl shadow-lg" id="btnActiveUsers">
        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
          <svg class="w-5 h-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414L8.414 15l-4.121-4.121a1 1 0 011.414-1.414L8.414 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div>
          <div class="text-gray-600 font-semibold text-sm">Active</div>
          <div class="text-gray-800 text-xl font-bold" id="activeUsersCount"></div>
        </div>
      </div>
  
      <!-- Pending Users -->
      <div class="flex items-center gap-4 p-5 bg-white rounded-2xl shadow-lg" id="btnPendingUsers">
        <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center">
          <svg class="w-5 h-5 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-2-9a1 1 0 012 0v1a1 1 0 01-2 0V9z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div>
          <div class="text-gray-600 font-semibold text-sm">Pending</div>
          <div class="text-gray-800 text-xl font-bold" id="pendingUsersCount"></div>
        </div>
      </div>
  
      <!-- Declined Users -->
      <div class="flex items-center gap-4 p-5 bg-white rounded-2xl shadow-lg" id="btnDeclinedUsers">
        <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center">
          <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.54-10.54a1 1 0 00-1.415-1.415L10 8.586 7.875 6.46a1 1 0 10-1.415 1.415L8.586 10l-2.126 2.125a1 1 0 101.415 1.415L10 11.414l2.125 2.126a1 1 0 001.415-1.415L11.414 10l2.126-2.125z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div>
          <div class="text-gray-600 font-semibold text-sm">Declined</div>
          <div class="text-gray-800 text-xl font-bold" id="declinedUsersCount"></div>
        </div>
      </div>
  
      <!-- Expired Users -->
      <div class="flex items-center gap-4 p-5 bg-white rounded-2xl shadow-lg" id="btnExpiredUsers">
        <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
          <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-3-9a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div>
          <div class="text-gray-600 font-semibold text-sm">Expired</div>
          <div class="text-gray-800 text-xl font-bold" id="expiredUsersCount"></div>
        </div>
      </div>
  
      <!-- All Users -->
      <div class="flex items-center gap-4 p-5 bg-white rounded-2xl shadow-lg" id="btnAllUsers">
        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
          <svg class="w-5 h-5 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
            <path d="M13 7a3 3 0 11-6 0 3 3 0 016 0zm-3 5a5 5 0 00-4.546 2.916A1 1 0 006 16h8a1 1 0 00.894-1.448A5 5 0 0010 12z"/>
          </svg>
        </div>
        <div>
          <div class="text-gray-600 font-semibold text-sm">All Users</div>
          <div class="text-gray-800 text-xl font-bold" id="totalUsersCount"></div>
        </div>
      </div>
      
    </div>
  </div>
  
  
  
  













  <div class="wrapper">
      <div class="container-fluid">
        <div class="row mb-3">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Admin Dashboard</h5>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                  <i class="bi bi-plus-circle"></i> Ongeza mtumiaji
                </button>
              </div>
              <div class="card-body">
                <div class="row mb-3">
                  <div class="col-md-6">
                    <div class="input-group">
                      <input type="text" id="searchInput" class="form-control" placeholder="Search...">
                      <button class="btn btn-outline-secondary" type="button" id="searchButton">
                        <i class="bi bi-search"></i>
                      </button>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <select class="form-select" id="statusFilter">
                      <option value="">All Statuses</option>
                      <option value="Pending">Pending</option>
                      <option value="Active">Active</option>
                      <option value="Expired">Expired</option>
                      <option value="Declined">Declined</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <button class="btn btn-outline-secondary w-100" id="refreshButton">
                      <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                  </div>
                </div>
                <div class="table-responsive">
                  <table class="table table-striped table-hover" id="usersTable">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>School</th>
                        <th>Status</th>
                        <th>Valid Until</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="usersTableBody">
                      <!-- Users will be loaded here -->
                    </tbody>
                  </table>
                </div>
                <nav aria-label="Page navigation">
                  <ul class="pagination justify-content-center" id="pagination">
                    <!-- Pagination will be loaded here -->
                  </ul>
                </nav>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add User Modal -->
  <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addUserModalLabel">Ongeza mtumiaji</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="addUserForm">
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="name" class="form-label">Jina kamili</label>
                <input type="text" class="form-control" id="name" required>
              </div>
              <div class="col-md-6">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" required>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="phone" class="form-label">Namba ya simu</label>
                <input type="tel" class="form-control" id="phone" required>
              </div>
              <div class="col-md-6">
                <label for="school" class="form-label">Jina la shule</label>
                <input type="text" class="form-control" id="school" required>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="proof" class="form-label">Uthibitisho wa muamala</label>
                <textarea class="form-control" id="proof" rows="3" required></textarea>
                <div class="form-text">Must include one of the authorized names or numbers.</div>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="status" class="form-label">Status</label>
                <select class="form-select" id="status">
                  <option value="Pending">Pending</option>
                  <option value="Active">Active</option>
                  <option value="Declined">Declined</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="validUntil" class="form-label">Valid Until</label>
                <input type="date" class="form-control" id="validUntil">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Funga</button>
          <button type="button" class="btn btn-primary" id="saveUserBtn">Hifadhi</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit User Modal -->
  <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editUserModalLabel">Hariri mtumiaji</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editUserForm">
            <input type="hidden" id="editId">
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="editName" class="form-label">Jina kamili</label>
                <input type="text" class="form-control" id="editName" required>
              </div>
              <div class="col-md-6">
                <label for="editEmail" class="form-label">Email</label>
                <input type="email" class="form-control" id="editEmail" required>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="editPhone" class="form-label">Namba ya simu</label>
                <input type="tel" class="form-control" id="editPhone" required>
              </div>
              <div class="col-md-6">
                <label for="editSchool" class="form-label">Jina la shulle</label>
                <input type="text" class="form-control" id="editSchool" required>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-12">
                <label for="editProof" class="form-label">Uthibitisho wa muamala</label>
                <textarea class="form-control" id="editProof" rows="3" required></textarea>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="editStatus" class="form-label">Status</label>
                <select class="form-select" id="editStatus">
                  <option value="Pending">Pending</option>
                  <option value="Active">Active</option>
                  <option value="Expired">Expired</option>
                  <option value="Declined">Declined</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="editValidUntil" class="form-label">Valid Until</label>
                <input type="date" class="form-control" id="editValidUntil">
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Funga</button>
          <button type="button" class="btn btn-primary" id="updateUserBtn">Sakinisha</button>
        </div>
      </div>
    </div>
  </div>

  <!-- View User Modal -->
  <div class="modal fade" id="viewUserModal" tabindex="-1" aria-labelledby="viewUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewUserModalLabel">Taarifa za mtumiaji</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <p><strong>jina:</strong> <span id="viewName"></span></p>
              <p><strong>Email:</strong> <span id="viewEmail"></span></p>
              <p><strong>Namba:</strong> <span id="viewPhone"></span></p>
            </div>
            <div class="col-md-6">
              <p><strong>Shule:</strong> <span id="viewSchool"></span></p>
              <p><strong>Status:</strong> <span id="viewStatus"></span></p>
              <p><strong>Valid Until:</strong> <span id="viewValidUntil"></span></p>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              <p><strong>Uthibitisho wa muamala:</strong></p>
              <div class="border p-2" id="viewProof"></div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Funga</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Thibitisha kufuta</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this user?</p>
          <input type="hidden" id="deleteId">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ghairi</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Futa</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanilla-datatables@1.6.16/dist/vanilla-dataTables.min.js"></script>
  
  
   
   <script>
  
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize variables
    let currentPage = 1;
    const perPage = 10;
    let usersData = [];
    let filteredData = [];
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbzUROSKBMfKU2Ex2Mw2lAxunR9155MX4PkNVBfAKRB5_wyc__LlBb1KqMh7sIkuXHz07g/exec';
  
    // Load user status counts
    function loadUserStatusCounts() {
      const params = new URLSearchParams({
        action: 'getUserCounts'
      });
      
      fetch(`${scriptUrl}?${params.toString()}`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            updateStatusCounters(data.counts);
          } else {
            showAlert('Imeshindwa kupakia takwimu za watumiaji: ' + data.message, 'danger');
          }
        })
        .catch(error => {
          console.error('Error loading user counts:', error);
          showAlert('Imeshindwa kupakia takwimu za watumiaji. Tafadhari jaribu tena.', 'danger');
        });
    }
  
    // Update the UI with user status counts
    function updateStatusCounters(counts) {
      document.getElementById('totalUsersCount').textContent = counts.total || 0;
      document.getElementById('activeUsersCount').textContent = counts.active || 0;
      document.getElementById('pendingUsersCount').textContent = counts.pending || 0;
      document.getElementById('expiredUsersCount').textContent = counts.expired || 0;
      document.getElementById('declinedUsersCount').textContent = counts.declined || 0;
    }
  
    // Load users based on page and status
    function loadUsers(page = 1, status = '') {
      currentPage = page;
      const params = new URLSearchParams({
        action: 'getUsers',
        page: page,
        perPage: perPage,
        status: status
      });
      
      fetch(`${scriptUrl}?${params.toString()}`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            usersData = data.data;
            filteredData = data.data;
            renderUsersTable();
            renderPagination(data.total, data.perPage, data.page);
          } else {
            showAlert('Imeshindwa kupakia watumiaji: ' + data.message, 'danger');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showAlert('Imeshindwa kupakia watumiaji. Tafadhari jaribu tena.', 'danger');
        });
    }
  
    // Render users table
    function renderUsersTable() {
      const tableBody = document.getElementById('usersTableBody');
      tableBody.innerHTML = '';
      
      if (filteredData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="8" class="text-center">Hakuna taarifa ya watumiaji iliyopatikana</td></tr>';
        return;
      }
      
      filteredData.forEach(user => {
        const row = document.createElement('tr');
        
        let validUntil = 'N/A';
        if (user.ValidUntil) {
          const date = new Date(user.ValidUntil);
          validUntil = date.toLocaleDateString();
        }
        
        let statusBadge = '';
        switch(user.Status) {
          case 'Pending':
            statusBadge = '<span class="badge badge-pending status-badge">Pending</span>';
            break;
          case 'Active':
            statusBadge = '<span class="badge badge-active status-badge">Active</span>';
            break;
          case 'Expired':
            statusBadge = '<span class="badge badge-expired status-badge">Expired</span>';
            break;
          case 'Declined':
            statusBadge = '<span class="badge badge-declined status-badge">Declined</span>';
            break;
        }
        
        row.innerHTML = `
          <td>${user.ID.substring(0, 8)}...</td>
          <td>${user.Name}</td>
          <td>${user.Email}</td>
          <td>${user.Phone}</td>
          <td>${user.School}</td>
          <td>${statusBadge}</td>
          <td>${validUntil}</td>
          <td>
            <button class="btn btn-sm btn-info view-btn" data-id="${user.ID}">
              <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-sm btn-warning edit-btn" data-id="${user.ID}">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-danger delete-btn" data-id="${user.ID}">
              <i class="bi bi-trash"></i>
            </button>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
      
      // Add event listeners to action buttons
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const userId = this.getAttribute('data-id');
          viewUser(userId);
        });
      });
      
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const userId = this.getAttribute('data-id');
          editUser(userId);
        });
      });
      
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const userId = this.getAttribute('data-id');
          confirmDelete(userId);
        });
      });
    }
  
    // Render pagination
    function renderPagination(totalItems, perPage, currentPage) {
      const totalPages = Math.ceil(totalItems / perPage);
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      
      if (totalPages <= 1) return;
      
      // Previous button
      const prevLi = document.createElement('li');
      prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
      prevLi.innerHTML = `<a class="page-link" href="#">Previous</a>`;
      prevLi.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentPage > 1) loadUsers(currentPage - 1, document.getElementById('statusFilter').value);
      });
      pagination.appendChild(prevLi);
      
      // Page numbers
      const startPage = Math.max(1, currentPage - 2);
      const endPage = Math.min(totalPages, currentPage + 2);
      
      for (let i = startPage; i <= endPage; i++) {
        const pageLi = document.createElement('li');
        pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
        pageLi.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        pageLi.addEventListener('click', (e) => {
          e.preventDefault();
          loadUsers(i, document.getElementById('statusFilter').value);
        });
        pagination.appendChild(pageLi);
      }
      
      // Next button
      const nextLi = document.createElement('li');
      nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
      nextLi.innerHTML = `<a class="page-link" href="#">Next</a>`;
      nextLi.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentPage < totalPages) loadUsers(currentPage + 1, document.getElementById('statusFilter').value);
      });
      pagination.appendChild(nextLi);
    }
  
    // View user details
    function viewUser(userId) {
      const user = filteredData.find(u => u.ID === userId);
      if (!user) return;
      
      document.getElementById('viewName').textContent = user.Name;
      document.getElementById('viewEmail').textContent = user.Email;
      document.getElementById('viewPhone').textContent = user.Phone;
      document.getElementById('viewSchool').textContent = user.School;
      document.getElementById('viewStatus').textContent = user.Status;
      document.getElementById('viewProof').textContent = user.Proof;
      
      let validUntil = 'N/A';
      if (user.ValidUntil) {
        const date = new Date(user.ValidUntil);
        validUntil = date.toLocaleDateString();
      }
      document.getElementById('viewValidUntil').textContent = validUntil;
      
      const modal = new bootstrap.Modal(document.getElementById('viewUserModal'));
      modal.show();
    }
  
    // Edit user
    function editUser(userId) {
      const user = filteredData.find(u => u.ID === userId);
      if (!user) return;
      
      document.getElementById('editId').value = user.ID;
      document.getElementById('editName').value = user.Name;
      document.getElementById('editEmail').value = user.Email;
      document.getElementById('editPhone').value = user.Phone;
      document.getElementById('editSchool').value = user.School;
      document.getElementById('editProof').value = user.Proof;
      document.getElementById('editStatus').value = user.Status;
      
      if (user.ValidUntil) {
        const date = new Date(user.ValidUntil);
        const formattedDate = date.toISOString().split('T')[0];
        document.getElementById('editValidUntil').value = formattedDate;
      } else {
        document.getElementById('editValidUntil').value = '';
      }
      
      const modal = new bootstrap.Modal(document.getElementById('editUserModal'));
      modal.show();
    }
  
    // Confirm delete
    function confirmDelete(userId) {
      document.getElementById('deleteId').value = userId;
      const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
      modal.show();
    }
  
    // Add new user
    document.getElementById('saveUserBtn').addEventListener('click', function() {
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const school = document.getElementById('school').value;
      const proof = document.getElementById('proof').value;
      const status = document.getElementById('status').value;
      const validUntil = document.getElementById('validUntil').value;
      
      const params = new URLSearchParams({
        action: 'addUser',
        name: name,
        email: email,
        phone: phone,
        school: school,
        proof: proof,
        status: status,
        validUntil: validUntil
      });
      
      fetch(scriptUrl, {
        method: 'POST',
        body: params
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('Mtumiaji ameongezwa kikamilifu!', 'success');
          document.getElementById('addUserForm').reset();
          bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
          loadUsers(currentPage, document.getElementById('statusFilter').value);
          loadUserStatusCounts(); // Refresh counts after adding user
        } else {
          showAlert('Error: ' + data.message, 'danger');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert('Imeshindwa kuongeza mtumiaji. Tafdhari jaribu tena.', 'danger');
      });
    });
  
    // Update user
    document.getElementById('updateUserBtn').addEventListener('click', function() {
      const id = document.getElementById('editId').value;
      const name = document.getElementById('editName').value;
      const email = document.getElementById('editEmail').value;
      const phone = document.getElementById('editPhone').value;
      const school = document.getElementById('editSchool').value;
      const proof = document.getElementById('editProof').value;
      const status = document.getElementById('editStatus').value;
      const validUntil = document.getElementById('editValidUntil').value;
      
      const params = new URLSearchParams({
        action: 'updateUser',
        id: id,
        name: name,
        email: email,
        phone: phone,
        school: school,
        proof: proof,
        status: status,
        validUntil: validUntil
      });
      
      fetch(scriptUrl, {
        method: 'POST',
        body: params
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('Mtumiaji amehaririwa kikamilifu!', 'success');
          bootstrap.Modal.getInstance(document.getElementById('editUserModal')).hide();
          loadUsers(currentPage, document.getElementById('statusFilter').value);
          loadUserStatusCounts(); // Refresh counts after updating user
        } else {
          showAlert('Error: ' + data.message, 'danger');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert('Imeshindwa kuhariri mtumiaji. Tafadhari jaribu tena.', 'danger');
      });
    });
  
    // Delete user
    document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
      const id = document.getElementById('deleteId').value;
      
      const params = new URLSearchParams({
        action: 'deleteUser',
        id: id
      });
      
      fetch(scriptUrl, {
        method: 'POST',
        body: params
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showAlert('Mtumiaji amefutwa kikamilifu!', 'success');
          bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
          loadUsers(currentPage, document.getElementById('statusFilter').value);
          loadUserStatusCounts(); // Refresh counts after deleting user
        } else {
          showAlert('Error: ' + data.message, 'danger');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showAlert('Imeshindwa kufuta mtumiaji. Tafadhari jaribu tena badae', 'danger');
      });
    });
  
    // Search functionality
    document.getElementById('searchButton').addEventListener('click', function() {
      performSearch();
    });
    
    document.getElementById('searchInput').addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
    
    function performSearch() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      if (!searchTerm) {
        filteredData = usersData;
      } else {
        filteredData = usersData.filter(user => 
          user.Name.toLowerCase().includes(searchTerm) ||
          user.Email.toLowerCase().includes(searchTerm) ||
          user.Phone.toLowerCase().includes(searchTerm) ||
          user.School.toLowerCase().includes(searchTerm) ||
          user.Status.toLowerCase().includes(searchTerm)
        );
      }
      renderUsersTable();
    }
  
    // Filter by status
    document.getElementById('statusFilter').addEventListener('change', function() {
      const status = this.value;
      loadUsers(1, status);
    });
  
    // Status filter buttons functionality
    function setupStatusButtons() {
      // All users button
      document.getElementById('btnAllUsers').addEventListener('click', function() {
        document.getElementById('statusFilter').value = '';
        loadUsers(1, '');
      });
      
      // Active users button
      document.getElementById('btnActiveUsers').addEventListener('click', function() {
        document.getElementById('statusFilter').value = 'Active';
        loadUsers(1, 'Active');
      });
      
      // Pending users button
      document.getElementById('btnPendingUsers').addEventListener('click', function() {
        document.getElementById('statusFilter').value = 'Pending';
        loadUsers(1, 'Pending');
      });
      
      // Expired users button
      document.getElementById('btnExpiredUsers').addEventListener('click', function() {
        document.getElementById('statusFilter').value = 'Expired';
        loadUsers(1, 'Expired');
      });
      
      // Declined users button
      document.getElementById('btnDeclinedUsers').addEventListener('click', function() {
        document.getElementById('statusFilter').value = 'Declined';
        loadUsers(1, 'Declined');
      });
    }
  
    // Refresh button
    document.getElementById('refreshButton').addEventListener('click', function() {
      loadUsers(currentPage, document.getElementById('statusFilter').value);
      loadUserStatusCounts();
    });
  
    // Show alert
    function showAlert(message, type) {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
      alertDiv.role = 'alert';
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      `;
      
      const container = document.querySelector('.container-fluid');
      container.prepend(alertDiv);
      
      setTimeout(() => {
        alertDiv.classList.remove('show');
        setTimeout(() => alertDiv.remove(), 150);
      }, 5000);
    }
  
    // Initialize
    loadUsers();
    loadUserStatusCounts();
    setupStatusButtons();
  });


</script>
 

</body>
</html>
  
 
